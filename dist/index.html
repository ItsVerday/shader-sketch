<!DOCTYPE html>
<html>
    <head>
        <title>Shader-Sketch</title>
        <style>
            body {
                overflow: hidden;
                padding: 0;
                margin: 0;
            }

            shader-sketch {
                width: 100vw;
                height: 101vh;
            }
        </style>
    </head>
    <body>
        <shader-sketch id="shader-sketch">
            <fragment-shader>
                float scene(vec3 position) {
                    float sphere = sdf_sphere(position, vec3(0., 0., 0.), 10.);
                    float subtract_sphere = sdf_sphere(position, vec3(0., 0., 0.), 2.);
                    sphere = sdf_subtraction(sphere, subtract_sphere);

                    return sdf_smooth_intersection(sphere, (simplex_noise_4d(vec4(position, timeElapsed * .2)) - .5) * .4, .1);
                }
                
                void main() {
                    vec2 pos = gl_FragCoord.xy / viewportSize;

                    vec3 look = camera_look(timeElapsed * 30., sin(timeElapsed * 2.) * 0., 45., viewportSize.x / viewportSize.y, pos);

                    const int iterations = 250;

                    RayMarch rayMarch = create_raymarch(vec3(0., 0., 0.), look, iterations);

                    for (int i = 0; i &lt; iterations; i++) {
                        if (rayMarch.finished) {
                            break;
                        }

                        rayMarch = iterate_raymarch(rayMarch, scene(rayMarch.position));
                    }

                    vec3 color = vec3(0., 0., 0.);

                    if (rayMarch.hit) {
                        vec3 normal = raymarch_normal(
                            scene(rayMarch.position),
                            scene(rayMarch.position + vec3(rayMarch.epsilon, 0., 0.)),
                            scene(rayMarch.position + vec3(0., rayMarch.epsilon, 0.)),
                            scene(rayMarch.position + vec3(0., 0., rayMarch.epsilon))
                        );
                        color = normal / 2. + .5;
                        color *= raymarch_ambient_occlusion(rayMarch, .005);
                    }
                    gl_FragColor = vec4(color, 1.);
                }
            </fragment-shader>
            <shader-import name="raymarch"></shader-import>
            <shader-import name="camera"></shader-import>
            <shader-import name="simplex_noise_4d"></shader-import>
        </shader-sketch>

        <script src="shader-sketch.js"></script>
    </body>
</html>